<!DOCTYPE html>
<html lang="zh-Hans">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 3.9.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"yoursite.com","root":"/","scheme":"Muse","version":"7.7.2","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="检查表制度比较深入认识到“检查表”(check-list)是源于傅盛的文章，他提到让工作变得可靠高效，检查表是个保障时效的好东西，看似机械但是可靠。随后是在《黑匣子思维》里面读到，进一步了解到纽约哈德孙河上迫降成功的背后（美当局还是对机组进行了详细地调查）起到积极作用的有无数次飞行的经验，过硬的心理素质，还有副机长分担责任在机长思考的同时协力沟通，副机长在短时间内把空客给的发动机停车的check-">
<meta property="og:type" content="article">
<meta property="og:title" content="CheckList">
<meta property="og:url" content="http://yoursite.com/2018/07/26/checkList/index.html">
<meta property="og:site_name" content="Here I write">
<meta property="og:description" content="检查表制度比较深入认识到“检查表”(check-list)是源于傅盛的文章，他提到让工作变得可靠高效，检查表是个保障时效的好东西，看似机械但是可靠。随后是在《黑匣子思维》里面读到，进一步了解到纽约哈德孙河上迫降成功的背后（美当局还是对机组进行了详细地调查）起到积极作用的有无数次飞行的经验，过硬的心理素质，还有副机长分担责任在机长思考的同时协力沟通，副机长在短时间内把空客给的发动机停车的check-">
<meta property="og:locale" content="zh-Hans">
<meta property="og:updated_time" content="2020-03-28T08:46:18.882Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="CheckList">
<meta name="twitter:description" content="检查表制度比较深入认识到“检查表”(check-list)是源于傅盛的文章，他提到让工作变得可靠高效，检查表是个保障时效的好东西，看似机械但是可靠。随后是在《黑匣子思维》里面读到，进一步了解到纽约哈德孙河上迫降成功的背后（美当局还是对机组进行了详细地调查）起到积极作用的有无数次飞行的经验，过硬的心理素质，还有副机长分担责任在机长思考的同时协力沟通，副机长在短时间内把空客给的发动机停车的check-">

<link rel="canonical" href="http://yoursite.com/2018/07/26/checkList/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-Hans'
  };
</script>

  <title>CheckList | Here I write</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Here I write</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-fw fa-home"></i>Home</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-fw fa-user"></i>About</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i>Tags</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>Archives</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post">
            

  <div class="posts-expand">
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/07/26/checkList/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Haining">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Here I write">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          CheckList
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2018-07-26 09:23:58" itemprop="dateCreated datePublished" datetime="2018-07-26T09:23:58+08:00">2018-07-26</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-03-28 16:46:18" itemprop="dateModified" datetime="2020-03-28T16:46:18+08:00">2020-03-28</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h1 id="检查表制度"><a href="#检查表制度" class="headerlink" title="检查表制度"></a>检查表制度</h1><p>比较深入认识到“检查表”(check-list)是源于<a href="https://mp.weixin.qq.com/s?__biz=MjM5NjgzMzkwMQ==&amp;mid=2653646406&amp;idx=1&amp;sn=9fc89b68138045f882a1f5dd04afbef4&amp;chksm=bd3cf1448a4b78527c0ba97e914fcbad89d429696d61fb087b18a87a266ef9cd076df86c1428&amp;mpshare=1&amp;scene=1&amp;srcid=0728p02JYofiPhU6NCYy4tnr#rd" target="_blank" rel="noopener">傅盛</a>的文章，他提到让工作变得可靠高效，检查表是个保障时效的好东西，看似机械但是可靠。随后是在《黑匣子思维》里面读到，进一步了解到纽约哈德孙河上迫降成功的背后（美当局还是对机组进行了详细地调查）起到积极作用的有无数次飞行的经验，过硬的心理素质，还有副机长分担责任在机长思考的同时协力沟通，副机长在短时间内把空客给的发动机停车的check-list走完。检查表制度已经完全融入了这些航空工业优秀从业者的工作中，如作者所说：人的因素可能是正面的也可能是负面的，然而可靠性的保证，需要仰仗人训练自己“黑匣子”一般的思维。回到傅盛，自己定下的check-list就一定要<strong>严格执行</strong>，要不然你将看不到当前check-list的缺陷，改进也就无从谈起，低级错误/已知错误还是会犯。check-list的存在意义在于，当你头脑不是特别清醒，状态不好的时候，也能给你一个完整严谨的流程，最大程度规避已知的一系列“低级错误”，不单纯依靠记忆和头脑，复杂系统尤为需要如此作业。</p>
<h1 id="为什么我要用在OpenFOAM上"><a href="#为什么我要用在OpenFOAM上" class="headerlink" title="为什么我要用在OpenFOAM上?"></a>为什么我要用在OpenFOAM上?</h1><p>同fluent或其他CFD软件，OpenFOAM算得上复杂系统，初学者容易犯错的系统：不像fluent通过按钮和已经编程的GUI来构建组织求解一个问题的逻辑链，OpenFOAM从边界条件、初始条件、网格文件、流体物性、离散格式、求解器（U求解器，p求解器）还有utility到用到的例如<code>sampleDict</code>，<code>changeDictionaryDict</code>，<code>refineMeshDict</code>，<code>topoSetDict</code>等，里面的逻辑关系通过一系列的文本文件来完成。信息的碎片化很可怕，想想你用vim去打开一个个文本文件来检查到底是哪里出了错，这样的过程必然是艰辛的。</p>
<p>为何容易犯错？</p>
<ol>
<li>文本文件有特定格式打错字也很常见</li>
<li>OpenFOAM在tutorial里面给的范本参照并不是MVP（<a href="https://book.douban.com/subject/27077719/" target="_blank" rel="noopener">Minimum Viable Product</a>），也就是说通常都有<strong>不必要</strong>的部分，初学者者并不清楚哪些信息必要，哪些重要，哪些完全没用。</li>
</ol>
<p>总之细节很多，细节一旦繁多而又难以从中抽离就难有大局观。而check-list就是提醒自己“从哪里出发”，“现在在哪里”，“还要去往哪里”。举例：像飞机起飞的check-list一样，一个check-list可以是对于某算例从无到有的按步骤一步步的配置。“从哪里出发”包括最基本的<code>0</code>，<code>constant</code>和<code>system</code>的文本文件结构，包括边界条件、初始条件，那么“项目的出发点”就是自己剔除上面提到的<strong>不必要</strong>部分后得到的MVP case，基于MVP case的基础可以做加密网格或者其他的变式。顾名思义，“现在在哪里”是check-list当前步骤，“还要去往哪里”取决于自己的目标。</p>
<p>记录“已知在某个步骤上会出现的问题”，然后据此设计check-list来规避已知问题，这是高于平时“工作的自己”层次的思维方式。工作的时候我要debug，要进入多层嵌套的代码，是细节的把控，而check-list让我跳出来，让我看到自己在地图的哪个地方，在某某步骤上的经验和教训是什么，接下来可能的问题是什么，问自己是主要矛盾吗，时间成本会是多少，应该如何决策，这是<strong>做决策</strong>的思维层次(<a href="https://book.douban.com/subject/27608239/" target="_blank" rel="noopener">原则</a>)。为何需要决策而不是单纯地使用？因为没有“机器”，或者说没有包装好的GUI会告诉我“现在到了哪一步，下一步需要做什么”。</p>
<p>总结一下：相较于fluent，OpenFOAM的劣势是文本文件之间的自然逻辑没有GUI来完成，优势是对一个功能如果充分了解，就可以有很大自由度进行操作（可以按照上面说到的check-list来完成步骤，实现步骤的“自动化”）,因而劣势可以弥补; OpenFOAM最大的优势还是完全开源，只有不懂的地方才是黑箱，经手的所有步骤都在掌握，所有的变量都在掌握</p>
<p>要知道，检查表可繁可简，为节约时间成本阿波罗13号出事之后检查表都被大规模简化，也就是“跳步”，而明白跳步的风险是简化的必须。所以检查表到底应该多繁多简，视情况而定。我根据自己的经验制作了一系列检查表，有的是配置算例流程，有的是关于某一个utility，还有NotToDo-list，总之对我怎么有用怎么来，还不止OpenFOAM，因为尤其跟CAE相关的软件都很大型，按钮特别多，记忆是不可靠的。加上如果在不同的计算机群上面计算，队列是不一样的，对用户的要求是不一样的（比如occigen上面对文件个数要求特别苛刻），用户的需求是不一样的（比如考虑到priority的问题，我又时候可能会选择提交一个计算时间较短的算例），情形很多，未必都需要检查表化，但按照自己的逻辑记录下要点，比起每次决策的时候再去网站上找零散的信息来得更高效。</p>
<h1 id="我的检查表"><a href="#我的检查表" class="headerlink" title="我的检查表"></a>我的检查表</h1><h2 id="Pointwise"><a href="#Pointwise" class="headerlink" title="Pointwise"></a>Pointwise</h2><h3 id="网格导出流程"><a href="#网格导出流程" class="headerlink" title="网格导出流程"></a>网格导出流程</h3><ul>
<li>[ ] Select Solver : OpenFOAM 3D</li>
<li>[x] Set BC types : make sure “all boundaries” are set or you may encounter -&gt; <code>--&gt; FOAM FATAL ERROR: Continuity error cannot be removed by adjusting the outflow. Please check the velocity boundary conditions and/or run potentialFoam to initialise the outflow.</code></li>
<li>[x] Select blocks</li>
<li>[ ] Export CAE to some “$CASE/constant/polyMesh”</li>
<li>[x] Rescale to meter : transformPoints -scale ’(0.001 0.001 0.001)’</li>
<li>[ ] checkMesh [注：这里的skewness感觉是有量纲的(1/L^3)，从mm变到m之后，skewness从O(1e-9)变到O(1)]</li>
<li>[ ] serial run to check</li>
</ul>
<h3 id="配置openfoam周期条件"><a href="#配置openfoam周期条件" class="headerlink" title="配置openfoam周期条件"></a>配置openfoam周期条件</h3><p><strong>语境</strong><br>Pointwise里面网格为domain，OpenFOAM里面网格为patch   </p>
<p>曾经天真的以为按照pointwise里面BC设定时选用<code>cyclic</code>，在网格文件生成完成后在<code>constant/polyMesh/boundary</code>里加上<code>neighbourPatch</code>就好，至少我在18.2R1这个版本不行。按照<a href="https://www.cfd-online.com/Forums/openfoam-meshing/61596-cyclic-bcs-pointwiseopenfoam-export.html" target="_blank" rel="noopener">Maddalenna</a>的提示。行得通的流程如下：   </p>
<ol>
<li><p>pointwise中要生成完全一样的domain，复制平移都不够（不够是指精度，重要的是点对点的对应关系），要达到这样的标准：create + periodic 这样生成的domain就是原先的twin，在domain list里面也可以看到domain之间的对应关系。这里就有了<code>neighbourPatch</code>的基础，没有这一步，极有可能会遇到<code>face 1 area does not match neighbour *** by ***% -- possible face ordering problem.</code></p>
</li>
<li><p>按照pointwise基本流程导出网格文件，但在设置BC的时候设置成<code>patch</code>而不是<code>cyclic</code></p>
</li>
<li><p>设置<code>createPatchDict</code>来完成<code>patch</code>到<code>cyclic</code>的转换. 默认createPatch 将生成新的网格文件，<code>-overwrite</code>可以改写原先网格文件，副产物还有一系列<code>*.obj</code>文件. 正确的dict配置如下：</p>
</li>
</ol>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//  File system/createPatchDict</span></span><br><span class="line"><span class="comment">//  姑且在这个语境中用“面”代替patch</span></span><br><span class="line"></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// Name of new patch</span></span><br><span class="line">        name front_cyclic;     <span class="comment">// 操作完成后会是cyclic类的面1的name</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// Type of new patch</span></span><br><span class="line">        patchInfo</span><br><span class="line">        &#123;</span><br><span class="line">            type            cyclic;      <span class="comment">// 新面1，类型</span></span><br><span class="line">            matchTolerance  <span class="number">0.001</span>;</span><br><span class="line">            neighbourPatch  back_cyclic; <span class="comment">// 对应的新面2</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// How to construct: either from patches or set</span></span><br><span class="line">        constructFrom patches;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// If constructFrom = patches : names of patches. Wildcards allowed.</span></span><br><span class="line">        patches ( front );    <span class="comment">// 旧面1</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#123;</span><br><span class="line">        name back_cyclic;      <span class="comment">// 新生成的会是cyclic类的面2</span></span><br><span class="line"></span><br><span class="line">        patchInfo</span><br><span class="line">        &#123;</span><br><span class="line">            type            cyclic;</span><br><span class="line">            matchTolerance  <span class="number">0.001</span>;</span><br><span class="line">            neighbourPatch  front_cyclic;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        constructFrom patches;</span><br><span class="line"></span><br><span class="line">        patches ( back );     <span class="comment">// 旧面2</span></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>这里需要解释一下：新面1,2是由旧1,2生成，生成的条件有“类型，matchTolerance,neighbourPatch”，当新2还没有生成的时候怎么将新1与新2对应呢？当然，这里<strong>如果</strong>把第一个大括号当成了新1 patch的constructor，它将找不到新2的定义。不过回想一下，其实旧12和新12都互为twin的关系，互相依赖，这样写并无道理，只是…程序具体怎么实现的就不知道了.<br><strong>注：为了保证无误，新旧1和新旧2的名字没有取一样；想改成新旧一样？在这个流程的最后把constant/polyMesh/boundary里面改过来就好</strong><br>注：createPatch在这里是由原先pointwise的twin domains/patches由类型<code>patch</code>变成了类型<code>cyclic</code>，据utility的功能介绍还可以将patches变成一个patch，或者将faceSet变一个patch</p>
<h2 id="OpenFOAM"><a href="#OpenFOAM" class="headerlink" title="OpenFOAM"></a>OpenFOAM</h2><h3 id="Simulation-完整流程"><a href="#Simulation-完整流程" class="headerlink" title="Simulation 完整流程"></a>Simulation 完整流程</h3><ol start="0">
<li>env                :<br>a)  purge modules<br>b)  set Foam environment : <code>of301_intel</code>   </li>
<li>mesh               :<br>a)  <code>transformPoints -scale &#39;(0.001 0.001 0.001)&#39;</code><br>b)  <code>checkMesh</code> [need a time dir (empty dir is OK)]<br>c)  推荐使用格式上mesh变成binary，无论计算时的读写还是paraview读入都会更快 : <code>foamFormatConvert -constant/-noZero</code> [OF-2.3.1和OF-3.0.1在binary上不兼容，得通过ascii转换]   </li>
<li>if needed, compile new BC</li>
<li>Set Initial Condition and Boundary Condition<br>a)  IC (<code>mapFields/topoSet</code>)[OF-2.3.1 的 mapFields 就是个bug，推荐OF-4.x]<br>b)  BC (<code>changeDictionary</code>) [推荐此处IC,BC均用ascii，便于查错和纠正]   </li>
<li>system/controlDict :<br>a)  check <code>startTime</code> 对不对, 保证startTime和endTime不相同[如果相同openfoam不会报错，log的末尾仍旧是”Finalising parallel run”]<br>b)  如果有自己编译的模块，加入<code>libs (&quot;*.so&quot;);</code>   </li>
<li>serial run check</li>
<li>if 5 is correct, prepare for parallel run :<br>a)  <code>decomposeParDict</code> 指定MPI并行进程数<br>b)  清除<code>startTime目录</code>里面’uniform’<br>c)  <code>decomposePar -time &#39;startTime&#39;</code> : double check流场是否正确地被decompose. 首先写入硬盘的是constant/polyMesh的划分，后<code>field transfer</code>是流场的划分<br>d)  BC : double check 一下BC有没有被正确写入<code>processor*</code>[value可能被改写，但原则上<code>member</code>一定要都在，在BC编写时<code>write(Ostream&amp;)</code>写对了就没有问题]<br>e)  if any warning : 要警惕，问题应当就出在当前步   </li>
<li>如果测试节点足够，可考虑interactive parallel test；如不够，配置slurm file:<br>a)  <code>#SBATCH --job-name</code> : <code>sqeue</code> 只能显示前8个字符<br>b)  队列, 节点数<code>#SBATCH --nodes</code>，每个节点task数<code>#SBATCH --ntasks-per-node</code>，总task数需要在<code>srun</code>或者<code>mpirun</code>那一行用到（可以小于<code>节点数*单个节点task数</code>）<br>c)  预估计算长<code>#SBATCH --time</code><br>d)  允许含有 bash variable<br>e)  默认定向输出：标准输出<code>#SBATCH --output</code>；error输出<code>#SBATCH --error</code><br>f)  slurm执行任务时的计算环境初始化配置 : [仅occigen]为避免module相关输出到error(竟然<code>module purge</code>也会输出到error我也是醉了，而我python moniter目前只扫描error文件里面有没有输出，认为没有输出才是正常运行状态)，这里slurm file 就不再加入任何的环境配置，通过第一个步骤即步骤<strong>0</strong>里面实现slurm任务提交时正确的环境配置[登陆之后第一个load的module为默认slurm提交环境，如果想换个环境，得logout然后重新登陆]<br>g)  注意 <code>--exclusive</code> 是否必要<br>h)  注意 <code>--mem</code> 是否足够<br>i)  主要任务执行行：即<code>srun</code>或<code>mpirun</code>那一行. 注意<strong>切忌</strong>行末加<code>&amp;</code>幻想后台运行[例如后面一行还有其他executable的情况，如果当下行能后台，其后的command会被继续执行也许会有便利…但这样做的结果是<code>&amp;</code>之后就没有然后了，而且还可能error message都没有，得不偿失]<br>j)  还在主要任务执行行 : 通常将标准输出改到 <code>&gt; logFile</code> : 注意最好把所有的log都留下，也就是每一个任务换一个文件名 [<em>改到</em>：因为前面谈到<code>#SBATCH --output</code>，用这个选项会由slurm在机群上的任务提交顺序来命名，可读性不强，通常改写]   </li>
<li>[选项] submit job chain via python :<br>a)  [仅occigen] 因为<code>$SCRATCH</code>文件数目限制 : checkList python laundary<br>b)  checkList python auto submit   </li>
<li>paraview           : 有条件的话（因为通常processor文件数目很多）优先读decomposed case (因为internalField没有影响，但经测试reconstruct可能<code>boundaryField</code>的value会被篡改)</li>
</ol>
<h3 id="preProcessing"><a href="#preProcessing" class="headerlink" title="preProcessing"></a>preProcessing</h3><h4 id="mapFields"><a href="#mapFields" class="headerlink" title="mapFields"></a>mapFields</h4><p>此为大坑，尤其是OF-2.x的版本，存在一些bug(不是fatal，但会让mapFields运行得无比慢，比fatal还可恶。按照<a href="https://www.cfd-online.com/Forums/openfoam-bugs/194353-mapfields-major-bug.html" target="_blank" rel="noopener">帖子</a>改了还是不行)，但用同样的mapFieldsDict试一试OpenFOAM/4.0-foss-2016b或者OpenFOAM-5.x不仅速度快而且不会有莫名其妙的报错</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="built_in">source</span>=/some/<span class="keyword">case</span>/to/be/mapped</span><br><span class="line"><span class="comment">#taget 这里target就是"."</span></span><br><span class="line"></span><br><span class="line">mapFields <span class="variable">$sourcedir</span> -<span class="keyword">case</span> . -noFunctionObjects -fields <span class="string">'(U p T)'</span> -sourceTime <span class="string">'8'</span> -targetRegion region0 &gt; log.mapFields_8 2&gt;&amp;1</span><br></pre></td></tr></table></figure>
<ol start="0">
<li>回避<br>a) $source里<code>empty</code>的BC（有试过，会有报错）<br>b) 如果$source里面constant/polyMesh/boundary里面有<code>mappedPatch</code>，且如果$target里面没有相应的BC配置，可能会在mapFields最后写入数据的时候报错后果是例如U文件的写入遇到错误而被跳过].在$source有<code>mappedPatch</code>的情况下，$target里面constant/polyMesh/boundary也得改成相应BC  </li>
<li>如果不是consistent，目标case里面要编辑好文件mapFieldsDict</li>
<li>确认$source里面startTime，它会是mapFields完成后的时间目录，输出格式改为ascii</li>
<li>检查在<code>controlDict</code>里面<code>libs (...)</code>是否在当下环境中配置</li>
<li>mapFields (等待时间可能很长)</li>
<li>手动检查mapFields是否无误地完成：检查目标case里面是否有’-nan’</li>
<li>把映射后的场的BC由<code>calculated</code>改成相应的物理BC，这样才可以续算，这个步骤可以通过changeDictionary来完成</li>
<li>串行试运行</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 一个长度为5D的圆管映射到一个长度为10D的圆管，inlet*完全对应</span></span><br><span class="line">/*--------------------------------*- C++ -*----------------------------------*\</span><br><span class="line">| =========                 |                                                 |</span><br><span class="line">| \\      /  F ield         | OpenFOAM: The Open Source CFD Toolbox           |</span><br><span class="line">|  \\    /   O peration     | Version:  2.3.1                                 |</span><br><span class="line">|   \\  /    A nd           | Web:      www.OpenFOAM.org                      |</span><br><span class="line">|    \\/     M anipulation  |                                                 |</span><br><span class="line">\*---------------------------------------------------------------------------*/</span><br><span class="line">FoamFile</span><br><span class="line">&#123;</span><br><span class="line">    version     2.0;</span><br><span class="line">    format      ascii;</span><br><span class="line">    class       dictionary;</span><br><span class="line">    location    <span class="string">"system"</span>;</span><br><span class="line">    object      mapFieldsDict;</span><br><span class="line">&#125;</span><br><span class="line">// * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * //</span><br><span class="line"></span><br><span class="line">patchMap        ( inlet0 inlet0         // Source 和 Target 都有的 patch</span><br><span class="line">                  inlet1 inlet1         // 且一一对应</span><br><span class="line">                  inlet2 inlet2</span><br><span class="line">                  inlet3 inlet3</span><br><span class="line">                  inlet4 inlet4 );</span><br><span class="line"></span><br><span class="line">cuttingPatches  ( wall                  // 剩下 wall patch 和 outlet*</span><br><span class="line">                  outlet0               // 此处为空-&gt;(U p)在 wall 和 oulet* 会出现异常大数甚至nan!!</span><br><span class="line">                  outlet1               // 只填 wall， wall上面插值没有异常大数出现</span><br><span class="line">                  outlet2               // 填上 wall patch 和 outlet*, outlet*都乖乖地保持了“最简单状态” (虽然U在 </span><br><span class="line">                  outlet3               // outlet*上面不应该是 uniform (0 0 0)，但毕竟是 <span class="built_in">type</span> calculated</span><br><span class="line">                  outlet4 );</span><br><span class="line"></span><br><span class="line">// ************************************************************************* //</span><br><span class="line"></span><br><span class="line"><span class="comment"># 两个T型圆管，几何完全一样，但网格不同</span></span><br><span class="line">/*--------------------------------*- C++ -*----------------------------------*\</span><br><span class="line">| =========                 |                                                 |</span><br><span class="line">| \\      /  F ield         | OpenFOAM: The Open Source CFD Toolbox           |</span><br><span class="line">|  \\    /   O peration     | Version:  2.3.1                                 |</span><br><span class="line">|   \\  /    A nd           | Web:      www.OpenFOAM.org                      |</span><br><span class="line">|    \\/     M anipulation  |                                                 |</span><br><span class="line">\*---------------------------------------------------------------------------*/</span><br><span class="line">FoamFile</span><br><span class="line">&#123;</span><br><span class="line">    version     2.0;</span><br><span class="line">    format      ascii;</span><br><span class="line">    class       dictionary;</span><br><span class="line">    location    <span class="string">"system"</span>;</span><br><span class="line">    object      mapFieldsDict;</span><br><span class="line">&#125;</span><br><span class="line">// * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * //</span><br><span class="line"></span><br><span class="line">patchMap        ( Port1 Port1        </span><br><span class="line">                  Port2 Port2</span><br><span class="line">				  Port3 Port3</span><br><span class="line">				  wall  wall  );</span><br><span class="line"></span><br><span class="line">cuttingPatches</span><br><span class="line">();</span><br><span class="line">// ************************************************************************* //</span><br></pre></td></tr></table></figure>
<h5 id="旋转data然后mapFields"><a href="#旋转data然后mapFields" class="headerlink" title="旋转data然后mapFields"></a>旋转data然后mapFields</h5><p>想要rotate data，transformPoints声称可以rotate polyMesh里面的points(也就是网格)，也可以rotate vector field.试过了，确实可以，paraview上就看出来转了90度，但是!将rotate过后的再mapFields就不成功了，经过反复测试始终还是rotate之前的data被map过去了的感觉</p>
<h3 id="postProcessing"><a href="#postProcessing" class="headerlink" title="postProcessing"></a>postProcessing</h3><h4 id="管理postProcessing"><a href="#管理postProcessing" class="headerlink" title="管理postProcessing"></a>管理postProcessing</h4><p><code>rsync.py</code>将远程的<code>postProcessing</code>同步到本地目录，并通过<code>json</code>将相关数据存入一个文本文件<code>database.txt</code>:   </p>
<ol>
<li><code>sourceDir</code>:远程目录   </li>
<li><code>targetDir</code>:本地目录   </li>
<li><code>name2plot</code>:画图的时候用到的legend<br>还有<code>alias</code>，即一个对case简单描述的string</li>
</ol>
<p>画图的时候，在配置文件<code>parameters_*.py</code>里面有：读<code>database.txt</code>，通过alias来索引<code>database[alias][&#39;targetDir&#39;]</code>和<code>database[alias][&#39;name2plot&#39;]</code></p>
<p>一旦按照以上操作“1.获取数据”并“2.抓取数据画图”，只需要确认有一致的<code>alias</code>就可以确认“画的数据是自己想要的”，具体的数据信息也可以通过<code>database.txt</code>来最终索引，只要这个索引不出错，就不会错</p>
<h4 id="uv-reynoldsStress"><a href="#uv-reynoldsStress" class="headerlink" title="uv : reynoldsStress"></a>uv : reynoldsStress</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># toolchain for uv_mean @12</span></span><br><span class="line">userAverageVector U -time <span class="string">'6:12'</span> <span class="comment"># U_mean</span></span><br><span class="line">userReyTensor_plusAvg U 12 -noIntermediateWrite -time <span class="string">'6:12'</span> <span class="comment"># reyTensor_mean, 不输出中间的reyTensor速度还是比较快的</span></span><br><span class="line">userRMSuvw_fromReyTensor_mean -time <span class="string">'12'</span> <span class="comment"># uv_mean</span></span><br><span class="line">sample -dict <span class="variable">$sampleDicts</span>/sets/set4uv -time <span class="string">'12'</span> &gt; log.set4uv 2&gt;&amp;1  <span class="comment"># 需要sampleDict : set4uv</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 需要注意的在这里</span></span><br><span class="line"><span class="comment"># 以上最后一步输出有128个sample的结果，但只用其中64个来算uv，因为上下壁面会相互抵消(uv的定义相对于壁面，v的定义在两个壁面是反的)</span></span><br><span class="line"><span class="comment"># 这就是[parameters_](https://github.com/snow-stone/python/blob/master/userSetUV/parameters_t_r-2a_1_gradP0p703125.py)里面`'raw_sample_size':64`的原因</span></span><br></pre></td></tr></table></figure>
<h4 id="userProbeByLabel-noMean"><a href="#userProbeByLabel-noMean" class="headerlink" title="userProbeByLabel_noMean"></a>userProbeByLabel_noMean</h4><p>or userProbeByLabelVector_noMean its version for vectors. <code>$sliceStore</code> is where you put your <code>slice</code>+<code>number</code> file (class labelList). userProbeByLabel_noMean dont work on slices but on <code>labelGroup</code> which is itself a <code>labelList</code> containing all cell id of probes of interest (its defaut location is <code>$sliceStore</code>.</p>
<ol start="0">
<li>checkList userFindClosestInLabelList</li>
<li>userProbeByLabel_noMean T $sliceStore -time ‘0:xxxx’ </li>
</ol>
<h4 id="userFindClosestInLabelList"><a href="#userFindClosestInLabelList" class="headerlink" title="userFindClosestInLabelList"></a>userFindClosestInLabelList</h4><p>前提是在input argument里面<code>sliceStore</code>处已经有<code>sliceNumberList</code>和<code>refVectors</code>，这个程序找的是遍历在<code>sliceNumberList</code>里面所有的slices找到离<code>refVectors</code>（<strong>注</strong>：这里仅有一个vector，但仍旧用vectors，为得是日后可以拓展）最近的cell，并将每个slice上面最近的cellID记下来写入到一个文件<code>labelGroup</code>.这个程序应当在一个OpenFOAM case中执行，其实就是提取网格信息，因此对于相同网格下的算例仅仅需要运行一次，于是就有了最后一个步骤将<code>labelGroup</code>移动到对应同一个网格的公共的目录下共享.详细checkList如下:</p>
<ol start="0">
<li>为了最终写出的labelList人类可读:<code>system/controlDikt</code> change format to ascii</li>
<li>userFindClosestInLabelList xx xx</li>
<li>cd constant</li>
<li>mv file to a shared place (for all cases with the same mesh structure)</li>
</ol>
<h4 id="reconstructPar"><a href="#reconstructPar" class="headerlink" title="reconstructPar"></a>reconstructPar</h4><p>在reconstructPar -fields ‘(U p)’之后，reconstructPar -fields ‘(phi)’会将phi添加到对应的时间目录里面.</p>
<h4 id="sample"><a href="#sample" class="headerlink" title="sample"></a>sample</h4><h5 id="基本流程"><a href="#基本流程" class="headerlink" title="基本流程"></a>基本流程</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line">sampleDict=system/sampleDict</span><br><span class="line"></span><br><span class="line">sample -dict <span class="variable">$sampleDict</span>/sets/Dai_lines_5cutsBetween2and3_typeFace_cell -time <span class="string">'8:10'</span> &gt; log.sample-Dai_lines_5cutsBetween2and3_typeFace_cell 2&gt;&amp;1</span><br></pre></td></tr></table></figure>
<ol>
<li>编辑sampleDict：可能需要用python脚本来写入一系列sets的描述，例如160条线就不能全部手写<br>a) 检查<code>fields</code>，如果写得不对，OpenFOAM并不会报错<br>b) 检查是否有header（没有header会有报错），<code>object</code>填<code>sampleDict</code><br>c) sets或者surfaces的输出文件名都可以个性化编辑</li>
<li>重命名sampleDict，是sets放目录$sampleDict/sets，是surfaces放目录$sampleDict/surfaces</li>
<li>sample</li>
</ol>
<p>注：检查不出sample是否有结果？<code>rm -rf postProcessing ; sample</code> 这样会比较明确</p>
<h5 id="用python写sampleDict"><a href="#用python写sampleDict" class="headerlink" title="用python写sampleDict"></a>用python写sampleDict</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># file writeSampleDict_2Diagonals.py</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">writeStartEnd</span><span class="params">(whichLineGroup,f,z,nPoints)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> whichLineGroup == <span class="number">0</span>:</span><br><span class="line">        f.write(<span class="string">"\t\t"</span>+ <span class="string">"type\t"</span>  + <span class="string">"uniform;"</span> +<span class="string">"\r\n"</span>)</span><br><span class="line">        f.write(<span class="string">"\t\t"</span>+ <span class="string">"axis\t"</span>  + <span class="string">"distance;"</span> +<span class="string">"\r\n"</span>)</span><br><span class="line">        f.write(<span class="string">"\t\t"</span>+ <span class="string">"start\t"</span> + <span class="string">"("</span>+z+ <span class="string">" 0.004 0.004);"</span> +<span class="string">"\r\n"</span>)</span><br><span class="line">        f.write(<span class="string">"\t\t"</span>+ <span class="string">"end\t"</span> + <span class="string">"("</span>+z+ <span class="string">" -0.004 -0.004);"</span> +<span class="string">"\r\n"</span>)</span><br><span class="line">        f.write(<span class="string">"\t\t"</span>+ <span class="string">"nPoints\t"</span> + str(nPoints) + <span class="string">";"</span> +<span class="string">"\r\n"</span>)</span><br><span class="line">    <span class="keyword">elif</span> whichLineGroup == <span class="number">1</span>:</span><br><span class="line">        f.write(<span class="string">"\t\t"</span>+ <span class="string">"type\t"</span>  + <span class="string">"uniform;"</span> +<span class="string">"\r\n"</span>)</span><br><span class="line">        f.write(<span class="string">"\t\t"</span>+ <span class="string">"axis\t"</span>  + <span class="string">"distance;"</span> +<span class="string">"\r\n"</span>)</span><br><span class="line">        f.write(<span class="string">"\t\t"</span>+ <span class="string">"start\t"</span> + <span class="string">"("</span>+z+ <span class="string">" -0.004 0.004);"</span> +<span class="string">"\r\n"</span>)</span><br><span class="line">        f.write(<span class="string">"\t\t"</span>+ <span class="string">"end\t"</span> + <span class="string">"("</span>+z+ <span class="string">" 0.004 -0.004);"</span> +<span class="string">"\r\n"</span>)</span><br><span class="line">        f.write(<span class="string">"\t\t"</span>+ <span class="string">"nPoints\t"</span> + str(nPoints) + <span class="string">";"</span> +<span class="string">"\r\n"</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">print</span> <span class="string">"big problem"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">writeLines</span><span class="params">(f,z_value_List,N,Nb_lineGroup,resolution,dictName)</span>:</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(Nb_lineGroup*N):</span><br><span class="line">        whichLineGroup = i // N  <span class="comment"># quotient  0, 1 ,2... Nb_lineGroup</span></span><br><span class="line">        j = i % N                <span class="comment"># remainder 0, 1, 2... Ns</span></span><br><span class="line">        </span><br><span class="line">        f.write(<span class="string">"\t"</span>+dictName+<span class="string">'-'</span>+str(i)+<span class="string">"\r\n"</span>)</span><br><span class="line">        f.write(<span class="string">"\t&#123;\r\n"</span>)</span><br><span class="line">        writeStartEnd(whichLineGroup,f,z_value_List[j],resolution)</span><br><span class="line">        f.write(<span class="string">"\t&#125;\r\n"</span>)</span><br><span class="line">        f.write(<span class="string">"\r\n"</span>)        </span><br><span class="line">    </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">write_LineSet</span><span class="params">(f,z_value_List,Nb_slices_along_z,Nb_lineGroup,resolution,dictName)</span>:</span></span><br><span class="line">    f.write(<span class="string">"sets\r\n"</span>)</span><br><span class="line">    f.write(<span class="string">"(\r\n"</span>)</span><br><span class="line">    writeLines(f,z_value_List,Nb_slices_along_z,Nb_lineGroup,resolution,dictName)</span><br><span class="line">    f.write(<span class="string">");\r\n"</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">write_headerSetting_sampleLines</span><span class="params">(f,fieldName,interpolationScheme)</span>:</span></span><br><span class="line">    f.write(<span class="string">"setFormat raw;\r\n"</span>)</span><br><span class="line">    f.write(<span class="string">"\r\n"</span>)</span><br><span class="line">    f.write(<span class="string">"interpolationScheme "</span>+interpolationScheme+<span class="string">";\r\n"</span>)</span><br><span class="line">    f.write(<span class="string">"\r\n"</span>)</span><br><span class="line">    f.write(<span class="string">"fields\r\n"</span>)</span><br><span class="line">    f.write(<span class="string">"(\r\n"</span>)</span><br><span class="line">    f.write(<span class="string">"\t"</span>+fieldName+<span class="string">"\r\n"</span>)</span><br><span class="line">    f.write(<span class="string">");\r\n"</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">write_sampleLines</span><span class="params">(dictName,fieldName,interpolationScheme,z_value_List,Nb_lineDisplacement,Nb_lineGroup,resolution)</span>:</span></span><br><span class="line">    f= open(dictName,<span class="string">"w"</span>)</span><br><span class="line">    write_headerSetting_sampleLines(f,fieldName,interpolationScheme)</span><br><span class="line">    write_LineSet(f,z_value_List,Nb_lineDisplacement,Nb_lineGroup,resolution,dictName)</span><br><span class="line">    f.close()</span><br><span class="line">    </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">NLines2Dict</span><span class="params">(Nb_lineDisplacement)</span>:</span></span><br><span class="line">    l = np.linspace(<span class="number">-0.08</span>,<span class="number">-0.04</span>,num=Nb_lineDisplacement)</span><br><span class="line">    listStr = [str(x) <span class="keyword">for</span> x <span class="keyword">in</span> l]</span><br><span class="line">    <span class="keyword">print</span> <span class="string">"A list of all line displacements :\n"</span></span><br><span class="line">    <span class="keyword">print</span> listStr</span><br><span class="line">    </span><br><span class="line">    dictName=<span class="string">"lineOn2Diagonals"</span></span><br><span class="line">    fieldName=<span class="string">"U_mean"</span></span><br><span class="line">    interpolationScheme=<span class="string">"cell"</span></span><br><span class="line">    write_sampleLines(dictName,fieldName,interpolationScheme,listStr,Nb_lineDisplacement,<span class="number">2</span>,resolution=<span class="number">200</span>)</span><br><span class="line">    </span><br><span class="line">    os.system(<span class="string">'dos2unix '</span>+dictName)</span><br><span class="line">    <span class="keyword">print</span> <span class="string">"\n"</span></span><br><span class="line">    <span class="keyword">print</span> <span class="string">"sampleDict written. Think to add a file header!"</span></span><br><span class="line"></span><br><span class="line">NLines2Dict(<span class="number">64</span>)</span><br></pre></td></tr></table></figure>
<ol>
<li><p>configure python script for sampleDict : dictName, fieldName, interpolationScheme… Sampled data will be named as `postProcessing/sets/time/dictName-n_fieldName. “dictName” may also includes information like “interpolationScheme”.</p>
</li>
<li><p>run python script</p>
</li>
<li><p>add header to sampleDict</p>
</li>
<li><p>run sample utility</p>
</li>
<li><p>verify generated files in <code>postProcessing</code></p>
</li>
<li><p>begin plotting using python</p>
</li>
<li><p>edit plot parameters : a spatial statistic will require “time”, “number of samples” etc. This file is the footprint of the statistics.</p>
</li>
<li><p>configure plot script : ajust “dataShape” or likewise. In other word, not all data are eligable because not all data are of the same shape. We can interpolate but I d rather not.</p>
</li>
<li><p>run plot script</p>
</li>
<li><p>ajust plot and save fig to <code>figure</code></p>
</li>
<li><p>write plot data (x,y) to txt file in foler <code>data</code> for reporducing use or later ajustement</p>
</li>
</ol>
<h2 id="python"><a href="#python" class="headerlink" title="python"></a>python</h2><h3 id="laundary"><a href="#laundary" class="headerlink" title="laundary"></a>laundary</h3><p>为了防止occigen <code>$SCRATCH</code>关于文件数量的quota溢出，用python在后台<code>nohup</code>长时间地监控，对<code>userDefinedLog</code>里面<code>removedTimes</code>与<code>dataWritingHistory</code>的补集的时间步做<code>reconstructPar</code>和<code>rm -rf processor*/timeStep</code>   </p>
<ol start="0">
<li>拷贝<code>laundary.py</code>和<code>reconstruct_occigen-OF301.sh</code>   </li>
<li>保证<code>userDefinedLog/removedTimes</code>存在</li>
<li>设置python脚本的时间参数（预估simu时长，留出laundary余量）和processor个数的参数</li>
<li>检查上一个laundary是否结束:<code>ls -l log.clean_*</code>看时间</li>
<li>判断<code>reconstructPar</code>的进程:<code>ls processor0 | xargs ls -l &gt; log.ls</code>；如果有的目录没有顺利reconstructPar会有内容(非std output)输出到终端，至于目录对应上了但场是否完全(比如<code>U p nu phi</code>) reconstructPar 只能看<code>log.ls</code><br>a) reconstructPar有很多时间步积压，手动完成laundary，然后进行b)<br>b) reconstructPar运行顺利，没有太多时间步积压在<code>processor*</code>里，那么准备续算：<code>rm userDefinedLog/dataWritingHistory</code>并清空<code>userDefinedLog/removedTimes</code>里面的内容</li>
<li><code>nohup python laundary.py OF301 &gt; log.clean_*</code></li>
<li>记录是在哪个登陆节点，需在<strong>对应的节点</strong>用<code>ps -eaf | grep $USER</code>才能找到<code>nohup</code>的任务</li>
</ol>
<h2 id="cluster"><a href="#cluster" class="headerlink" title="cluster"></a>cluster</h2><h3 id="occigen"><a href="#occigen" class="headerlink" title="occigen"></a>occigen</h3><h4 id="算例提交"><a href="#算例提交" class="headerlink" title="算例提交"></a>算例提交</h4><ol start="0">
<li>openfoam env : <strong>一句话</strong>如果用python来做slurm多个连续任务提交，必须在提交前做好这一步(即checkList第<code>0</code>步).具体来说如果忘记了提交slurm会在第一个job报错，然后你发现slurm找不到<code>mpirun</code>，这时候补上环境变量再重新提交，新的提交第一个job能通过，但第二个job仍然会报错<code>找不到mpirun</code>；似乎slurm的默认环境是你登陆某login节点后第一次提交任务的环境，也就是说：login之后得首先做这个事情再提交任何算例(虽然直接使用<code>sbatch **</code>倒是不影响，但对通过python来提交的job chain会被迫终断）</li>
<li>nohup python submit.py &gt; log.submit : 提交job，通过<code>squeue</code>的返回值<strong>离散地</strong>监控job状态，通过返回值来检验一个算例完成后(这里还有个bug)修改<code>system/controlDict</code>里面<code>startTime</code>和<code>endTime</code>用于自动提交下一个算例(限制：simuLog不停地被改写，应该把每个job的log都留下来才好)；log.submit取好名字以方便查看</li>
<li>nohup python watchDog.py &gt; log.watchDog : 设置一个运行最大时长，在这个时间内用<code>reconstructPar</code>来保留计算输出数据，删除<code>processor*</code>里面已经<code>reconstructPar</code>完成地时间步大幅度削减文件个数，保证不超过scratch的限额；log取好名字以方便查看<br>G3.  笔记本上面记录下来是哪个login，什么算例，连续提交多少个job，每个job预计计算的物理的间隔是多少(用于更新<code>startTime</code>和<code>endTime</code>)：因为<code>ps -eaf | grep $USER</code>只能找出相应登陆节点上面的job</li>
<li>检查<code>log.submit</code>，查看jobs的情况</li>
</ol>
<h4 id="数据同步"><a href="#数据同步" class="headerlink" title="数据同步"></a>数据同步</h4><p>千万千万要注意<code>para0</code>，在<code>dir</code>里面并没有用到，一定要double check !!!!<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line">para0=inlet_0p3</span><br><span class="line">para1=a_0p08</span><br><span class="line">para2=setT_St_1</span><br><span class="line"><span class="built_in">log</span>=sync_log.<span class="variable">$para1</span></span><br><span class="line">dir=/store/lmfa/fct/hluo/occigen/caseByGeometry/T/shape_square/2a_3_T/BirdCarreau/inlet_0p3/<span class="variable">$para1rsync</span> -av occigen:/scratch/cnt0028/mfa0464/hluo/caseByGeometry/T/shape_square/2a_3_T/BirdCarreau/<span class="variable">$para0</span>/<span class="variable">$para1</span>/<span class="variable">$para2</span>/* DATA --exclude processor* &amp;&amp;</span><br><span class="line"><span class="built_in">echo</span> <span class="string">"DATA sync BirdCarreau : <span class="variable">$para0</span> <span class="variable">$para1</span> <span class="variable">$para2</span> ended with success"</span> &gt;&gt; <span class="variable">$dir</span>/<span class="variable">$log</span></span><br></pre></td></tr></table></figure></p>
<h3 id="newton"><a href="#newton" class="headerlink" title="newton"></a>newton</h3><ol>
<li>No <code>#SBATCH --exclusive</code> (if not necessary)</li>
<li>Naming of the file with exactly 8 chars with <code>-2</code> indicates for example 2nd run. Ex : <code>p10D_gP5-2</code></li>
<li>consider remove <code>#SBATCH --mem-per-cpu=4000</code> because there are nodes which bigger memory available</li>
</ol>
<h4 id="error"><a href="#error" class="headerlink" title="error"></a>error</h4><ol>
<li><code>error while loading shared libraries: libpsm_infinipath.so.1: cannot open shared object file: No such file or directory</code> : check <code>#SBATCH --mem</code>, this is an error saying you are maybe asking for more memory than the machine can offer</li>
<li><code>slurmstepd: error: Detected 1 oom-kill event(s) in step...</code> : check <code></code>#SBATCH –mem`, this is an errory saying that the memory you are asking for is not enough for the program</li>
</ol>
<h4 id="old-note"><a href="#old-note" class="headerlink" title="old note"></a>old note</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment"># FILE : p10D_gP5-2</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#BATCH --job-name=MeshConvergence                    # Is this even useful ? SABTCH no?</span></span><br><span class="line"><span class="comment">#SBATCH --output=job.%j.out</span></span><br><span class="line"><span class="comment">#SBATCH --error=job.%j.err </span></span><br><span class="line"><span class="comment">#SBATCH --mail-user=haining.luo@doctorant.ec-lyon.fr</span></span><br><span class="line"><span class="comment">#SBATCH --mail-type=ALL</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#SBATCH --partition=mononode</span></span><br><span class="line"><span class="comment">#SBATCH --mem-per-cpu=4000</span></span><br><span class="line"><span class="comment">#SBATCH --nodes=1</span></span><br><span class="line"><span class="comment">#SBATCH --ntasks-per-node=16</span></span><br><span class="line"><span class="comment">#SBATCH --cpus-per-task=1</span></span><br><span class="line"><span class="comment">#SBATCH -t 1-00:00:00</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># number of simulation</span></span><br><span class="line">nos=2</span><br><span class="line">logFile=logSimulation<span class="variable">$nos</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 在newton上module purge load部分可以保留</span></span><br><span class="line">module purge</span><br><span class="line"><span class="comment"># Opt/Debug mode on</span></span><br><span class="line">module load OpenMPI/1.6.5-GCC-4.8.3 ; \</span><br><span class="line">. /home/lmfa/hluo/LocalSoftware/OpenFOAM/OpenFOAM-2.3.x/etc/bashrc.Opt</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"NodeName = "</span> <span class="variable">$SLURMD_NODENAME</span> &gt;&gt; <span class="variable">$logFile</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"JobID = "</span> <span class="variable">$SLURM_JOB_ID</span> &gt;&gt; <span class="variable">$logFile</span></span><br><span class="line"></span><br><span class="line">mpirun -np 16 pimpleFoam -parallel &gt;&gt; <span class="variable">$logFile</span></span><br></pre></td></tr></table></figure>
<ol start="3">
<li>run mapFields need a big memory. Theres now a template for big-memory job. Especially, dont put <code>&amp;</code> at the end of commands or mapFields will only last for 2s and theres no error message returned so could be confusing.</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">##SBATCH --job-name=T-1b_mirrorMerge_mapped</span></span><br><span class="line"><span class="comment">#SBATCH --output=job.%j.out</span></span><br><span class="line"><span class="comment">#SBATCH --error=job.%j.err </span></span><br><span class="line"><span class="comment">#SBATCH --mail-user=haining.luo@doctorant.ec-lyon.fr</span></span><br><span class="line"><span class="comment">#SBATCH --mail-type=ALL</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#SBATCH --partition=test</span></span><br><span class="line"><span class="comment">#SBATCH --mem=32000                  # asking for 32000Mb ~ 30Gb of memory </span></span><br><span class="line"><span class="comment">#SBATCH --nodes=1                    # 1 node</span></span><br><span class="line"><span class="comment">#SBATCH --ntasks-per-node=1          # one task for one node</span></span><br><span class="line"><span class="comment">##SBATCH --cpus-per-task=1           # one cpu per task</span></span><br><span class="line"><span class="comment">##SBATCH -t 1:00:00</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># number of simulation</span></span><br><span class="line">nos=1</span><br><span class="line">logFile=logSimulation<span class="variable">$nos</span></span><br><span class="line"></span><br><span class="line">module purge</span><br><span class="line"><span class="comment"># debug mode on</span></span><br><span class="line">module load OpenMPI/1.6.5-GCC-4.8.3 ; \</span><br><span class="line">. /home/lmfa/hluo/LocalSoftware/OpenFOAM/OpenFOAM-2.3.x/etc/bashrc.Opt</span><br><span class="line"></span><br><span class="line"><span class="comment"># run solver </span></span><br><span class="line"><span class="comment">#decomposePar  # Do this manually</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"NodeName = "</span> <span class="variable">$SLURMD_NODENAME</span> &gt;&gt; <span class="variable">$logFile</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"JobID = "</span> <span class="variable">$SLURM_JOB_ID</span> &gt;&gt; <span class="variable">$logFile</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#mpirun -np 64 icoFoam -parallel &gt;&gt; $logFile</span></span><br><span class="line"></span><br><span class="line">sourcedir=/home/lmfa/hluo/LocalSoftware/OpenFOAM/hluo-2.3.x/run/1b_mirrorMerge_mapped_NearestFace</span><br><span class="line">mapFields <span class="variable">$sourcedir</span> -<span class="keyword">case</span> . -noFunctionObjects -fields <span class="string">'(U p)'</span> -sourceTime <span class="string">'6.01'</span> -targetRegion region0 &gt; logMapFields_new 2&gt;&amp;1  <span class="comment"># No "&amp;" here</span></span><br></pre></td></tr></table></figure>
<p>Here maybe a reason that zaurak well perform likely 2 times better than cpus on newton when the constraint on memory is not there.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">hluo@zaurak $ cat /proc/cpuinfo | grep model</span><br><span class="line"><span class="comment">#...</span></span><br><span class="line">model name	: Intel(R) Xeon(R) CPU E5-1620 v4 @ 3.50GHz</span><br><span class="line"></span><br><span class="line">hluo@compil-haswell $ cat /proc/cpuinfo | grep model</span><br><span class="line"><span class="comment">#...</span></span><br><span class="line">model name	: Intel(R) Xeon(R) CPU E5-2660 v3 @ 2.60GHz</span><br><span class="line"></span><br><span class="line">hluo@visu $ cat /proc/cpuinfo | grep model</span><br><span class="line"><span class="comment">#...</span></span><br><span class="line">model name	: Intel(R) Xeon(R) CPU E5-2640 v4 @ 2.40GHz</span><br></pre></td></tr></table></figure>
<h2 id="Inkscape"><a href="#Inkscape" class="headerlink" title="Inkscape"></a>Inkscape</h2><h3 id="导出"><a href="#导出" class="headerlink" title="导出"></a>导出</h3><ul>
<li>[ ] draw sketch</li>
<li>[x] Edit-&gt; Resize page to selection</li>
<li>[ ] Export PNG image -&gt; Export as -&gt; Export</li>
</ul>
<p>在最后一步如果遇到”the chosen area to be exported is invalid”,可以在<code>Export PNG Image</code>标签页里面四个标签<code>Page</code>,<code>Drawing</code>,<code>Selection</code>,<code>Custom</code>（默认是最后一个），选成比如说<code>Drawing</code>再点<code>Export</code>.</p>
<h3 id="clip"><a href="#clip" class="headerlink" title="clip"></a>clip</h3><ol>
<li>import image</li>
<li>F4 (select “rectangular tool”) draw a rectangular (marked by red)</li>
<li>F1 (select “select tool”), ctrl+A select all</li>
<li>Object -&gt; clip -&gt; set</li>
</ol>
<h2 id="gimp"><a href="#gimp" class="headerlink" title="gimp"></a>gimp</h2><p>这个软件可以得到图片里面的坐标</p>
<h2 id="paraview"><a href="#paraview" class="headerlink" title="paraview"></a>paraview</h2><h3 id="显示几何外形"><a href="#显示几何外形" class="headerlink" title="显示几何外形"></a>显示几何外形</h3><p>如果想要显示一下外形，但又不想要网格视角:<br>Clean to grid -&gt; Extract surface -&gt; change opacity</p>
<h3 id="scripting"><a href="#scripting" class="headerlink" title="scripting"></a>scripting</h3><h4 id="load-state"><a href="#load-state" class="headerlink" title="load state"></a>load state</h4><p><code>load state</code>也可以被载入到script里面(no legend)</p>
<p>I. 用paraview生成<code>*.psvm</code>   </p>
<ol>
<li><code>paraview</code> -&gt; start trace -&gt; open *.foam -&gt; …   </li>
<li>saveFig (very possible I will do this. otherwise its nonsense.)   </li>
<li>save state   </li>
<li>stop trace</li>
</ol>
<p>II. 拿出上一步得到的script，把关键行(例如)<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">LoadState(<span class="string">'/store/T_c/1j/D2-NN-1j_test_from0p3_forcingSinus_St3p2_A_eq_0p05/hluo15_T_c_vorticity_z_300.pvsm'</span>, LoadStateDataFileOptions=<span class="string">'Use File Names From State'</span>,</span><br><span class="line">    DataDirectory=<span class="string">'/store/T_c/1j/D2-NN-1j_test_from0p3_forcingSinus_St3p2_A_eq_0p05'</span>,</span><br><span class="line">    OnlyUseFilesInDataDirectory=<span class="number">0</span>,</span><br><span class="line">    D2NN1k_syn_forcingfoamFileName=<span class="string">'/store/T_c/1j/D2-NN-1j_test_from0p3_forcingSinus_St3p2_A_eq_0p05/D2-NN-1k_syn_forcing.foam'</span>)</span><br></pre></td></tr></table></figure></p>
<p>转换为<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">SaveScreenshot(dirName+<span class="string">'/'</span>+<span class="string">'hluo15_T_c_vorticity_z_300.png'</span>, renderView1, ImageResolution=[<span class="number">2754</span>, <span class="number">1838</span>],</span><br><span class="line">    FontScaling=<span class="string">'Scale fonts proportionally'</span>,</span><br><span class="line">    OverrideColorPalette=<span class="string">''</span>,</span><br><span class="line">    StereoMode=<span class="string">'No change'</span>,</span><br><span class="line">    TransparentBackground=<span class="number">0</span>, </span><br><span class="line">    <span class="comment"># PNG options</span></span><br><span class="line">    CompressionLevel=<span class="string">'5'</span>)</span><br></pre></td></tr></table></figure></p>
<p>尾巴上再加入<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">print</span> <span class="string">"Finalizing "</span>+ os.path.basename(__file__) +<span class="string">" "</span> + <span class="string">"@ dir : "</span> + dirName </span><br><span class="line"><span class="keyword">import</span> datetime</span><br><span class="line"><span class="keyword">print</span> datetime.datetime.now().strftime(<span class="string">"%Y-%m-%d %H:%M"</span>)</span><br><span class="line"><span class="keyword">print</span> <span class="string">"==============================="</span></span><br></pre></td></tr></table></figure></p>
<p>III. 对不同目录（不同case）批量操作:   </p>
<ol>
<li>拷贝<code>*.psvm</code>到相应目录（如果pvpython找不到<code>*.psvm</code>也会出图，白板）   </li>
<li>修改<code>*.psvm</code>里面带有关键字<code>.foam</code>的行，对应当下目录   </li>
<li>来到<code>run.sh</code>，用绝对路径作为参数开始批量运行</li>
</ol>
<h4 id="出图程序里面修改变量的range"><a href="#出图程序里面修改变量的range" class="headerlink" title="出图程序里面修改变量的range"></a>出图程序里面修改变量的range</h4><p><code>LUT.RGBPoints</code>和<code>PWF.Points</code>里面上下界都得改，<code>PWF.RescaleTransferFunction</code>也要改，当然<code>LUT.UseLogScale</code>也要改：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment"># get color transfer function/color map for 'k_mean_nonD'</span></span><br><span class="line"><span class="comment"># ...</span></span><br><span class="line">k_mean_nonDLUT.RGBPoints = [<span class="number">1e-6</span>, <span class="number">0.231373</span>, <span class="number">0.298039</span>, <span class="number">0.752941</span>, <span class="number">0.00014459355054441403</span>, <span class="number">0.865003</span>, <span class="number">0.865003</span>, <span class="number">0.865003</span>, <span class="number">1</span>, <span class="number">0.705882</span>, <span class="number">0.0156863</span>, <span class="number">0.14902</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># get opacity transfer function/opacity map for 'k_mean_nonD'</span></span><br><span class="line"><span class="comment"># ...</span></span><br><span class="line">k_mean_nonDPWF.Points = [<span class="number">1e-06</span>, <span class="number">0.0</span>, <span class="number">0.5</span>, <span class="number">0.0</span>, <span class="number">1</span>, <span class="number">1.0</span>, <span class="number">0.5</span>, <span class="number">0.0</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># Rescale transfer function</span></span><br><span class="line">k_mean_nonDPWF.RescaleTransferFunction(<span class="number">1e-06</span>, <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Properties modified on k_mean_nonDLUT</span></span><br><span class="line">k_mean_nonDLUT.UseLogScale = <span class="number">0</span></span><br></pre></td></tr></table></figure></p>
<h4 id="纯粹读数据，摸索数据结构"><a href="#纯粹读数据，摸索数据结构" class="headerlink" title="纯粹读数据，摸索数据结构"></a>纯粹读数据，摸索数据结构</h4><p>似乎是默认读最后一个时间步，为免出错，每个case就一个时间步<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#### import the simple module from the paraview</span></span><br><span class="line"><span class="keyword">from</span> paraview.simple <span class="keyword">import</span> *</span><br><span class="line"><span class="comment">#### disable automatic camera reset on 'Show'</span></span><br><span class="line">paraview.simple._DisableFirstRenderCameraReset()</span><br><span class="line"></span><br><span class="line"><span class="comment"># create a new 'OpenFOAMReader'</span></span><br><span class="line">cavityfoam = OpenFOAMReader(FileName=<span class="string">'/home/hluo/OpenFOAM/hluo-2.3.1/run/tutorials/incompressible/icoFoam/cavity_org/cavity.foam'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> type(cavityfoam)</span><br><span class="line"><span class="keyword">print</span> cavityfoam.CellArrays</span><br><span class="line"><span class="keyword">print</span> type(cavityfoam.CellArrays)</span><br><span class="line"><span class="keyword">print</span> <span class="string">"GetAvailable()"</span></span><br><span class="line"><span class="keyword">print</span> cavityfoam.CellArrays.GetAvailable()</span><br><span class="line"><span class="keyword">print</span> <span class="string">"GetData()"</span></span><br><span class="line"><span class="keyword">print</span> cavityfoam.CellArrays.GetData()</span><br><span class="line"></span><br><span class="line">data=servermanager.Fetch(cavityfoam)</span><br><span class="line"><span class="keyword">print</span> type(data)</span><br><span class="line"><span class="keyword">print</span> <span class="string">"GetNumberOfBlocks() : "</span> , data.GetNumberOfBlocks()</span><br><span class="line"><span class="comment">#print "getBlock() : " , data.GetBlock(1)</span></span><br><span class="line">obj = data.GetBlock(<span class="number">0</span>)</span><br><span class="line"><span class="keyword">print</span> obj.GetNumberOfCells()</span><br><span class="line"></span><br><span class="line">cellData = obj.GetCellData()</span><br><span class="line">N = obj.GetNumberOfCells()</span><br><span class="line"><span class="comment">#print cellData</span></span><br><span class="line">obj_p = cellData.GetArray(<span class="string">'p'</span>)</span><br><span class="line"><span class="keyword">print</span> type(obj_p)</span><br><span class="line"><span class="keyword">print</span> <span class="string">"obj_p.GetDataTypeValueMin() : "</span>, obj_p.GetDataTypeValueMin() <span class="comment"># 这里得出的最大最小有问题</span></span><br><span class="line"><span class="keyword">print</span> <span class="string">"obj_p.GetDataTypeValueMax() : "</span>, obj_p.GetDataTypeValueMax()</span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> obj_p.GetValue(<span class="number">10</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> <span class="string">"GetRange() : "</span>, obj_p.GetRange() <span class="comment"># 这里貌似是正确的</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(N):</span><br><span class="line">    obj_p.SetValue(i, obj_p.GetValue(i)/<span class="number">10</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> obj_p.GetValue(<span class="number">10</span>)</span><br></pre></td></tr></table></figure></p>
<h3 id="export-screen-shot"><a href="#export-screen-shot" class="headerlink" title="export screen shot"></a>export screen shot</h3><p>export 有什么好说的？嗯……如果要对一系列算例做同样的图一般会选用<code>load state</code>来加载<code>*.pvsm</code>，似乎注意改一下<code>*.foam</code>对应的<code>path</code>就好，但是如果要让export screen shot输出同样像素的图的话，记得一定要全屏之后再export！！</p>
<h3 id="do-not-skip-time-0"><a href="#do-not-skip-time-0" class="headerlink" title="do not skip time 0"></a>do not skip time 0</h3><ol>
<li>paraview data.foam</li>
<li>uncheck all “Cell Array” ; remain defaut “Skip Zero Time” then apply : geometry will be visualized but no “Cell Array” (<strong>field data</strong>) is there. Make sense.</li>
<li>uncheck “Skip Zero Time” -&gt; apply : cell array will then appear ; select field of interest.</li>
</ol>
<h3 id="color-map"><a href="#color-map" class="headerlink" title="color map"></a>color map</h3><ul>
<li>如果是对成的数据<code>[-a,a]</code>，用红白蓝<code>diverging</code>挺好，能分辨出<code>0</code>对应白</li>
<li>如果是<code>[0,a]</code>，用黑白灰最好，但paraview好像默认可以从<code>Edit Color Map</code>选项卡中带桃心的小按钮<code>Choose Preset</code>里面有<code>X-ray</code>和<code>GrayScale</code>，选择后apply（默认就会变到RGB color Space）；如果想要恢复diverging，最下面有个恢复默认按钮；如果想要自定义，参见<a href="https://www.cfd-online.com/Forums/openfoam-paraview/105630-paraview-gray-scale-white-black.html" target="_blank" rel="noopener">RBG自定义</a></li>
</ul>
<h3 id="用load-state来复现camera视角"><a href="#用load-state来复现camera视角" class="headerlink" title="用load state来复现camera视角"></a>用load state来复现camera视角</h3><p>target 目标视角：想要复制的视角，对应的case叫目标case<br>working 工作视角：想要在工作case下复现目标视角   </p>
<ol start="0">
<li>目标视角的存储通过目标case(Visu)里<code>save state</code>来实现(默认读取了一个绝对路径的但其实为空白的<code>target.foam</code>文件)，得到<code>target.pvsm</code></li>
<li>复制目标case下的<code>target.pvsm</code>到工作case(Visu)里，编辑查找关键字<code>target.foam</code>并替换成<code>工作路径/working.foam</code></li>
<li>工作路径下创建<code>working.foam</code></li>
<li>工作路径下打开paraview</li>
<li>load state 选择编辑后的<code>target.pvsm</code>-&gt; “Load State Data File Options” 选<code>Use File Names From State</code></li>
<li>等待复现</li>
</ol>
<p>注意：</p>
<ol>
<li>还涉及一个working case里面时间步是不是和state里面一致的事情，我的测试刚好target和working case有相对应的同一时刻的data</li>
<li>在paraview-5.4.1测试成功</li>
</ol>
<h3 id="根据x坐标截取一个cell-slice的label"><a href="#根据x坐标截取一个cell-slice的label" class="headerlink" title="根据x坐标截取一个cell slice的label"></a>根据x坐标截取一个cell slice的label</h3><p>cell slice : 这里的网格是正交的六面体，所以严格意义上一个x坐标对应“一层网格”，通过在paraview里面<code>find Data</code>中选取<code>xcoord between xx and xx</code>就可以选定这一系列cell<br>label      : 一系列的cell的label合起来就是个labelList，而且是全局的，因此可以取出<code>U</code>中例如<code>U[labelList_slice0]</code>子集进行操作   </p>
<p>下为流程：</p>
<ol start="0">
<li>paraview 可视化 case</li>
<li>calculator : xcoord (defaut : point data)</li>
<li>Filters -&gt; Point data to cell data 这里我们只想对xcoord操作 但<strong>注意</strong> 这一步会将U(如果有的话)也插值一遍，值会跟先前有略微差别</li>
<li>Edit -&gt; fidn Data -&gt; (cells) (Pointdatatocelldata) (criteria : xcoord between [xmin, xmax] -&gt; run selection</li>
<li>close “find Data” (selection is still effective)</li>
<li>split horozontal (very smalll icon on the right above render view) -&gt; spread sheet -&gt; show only selected elements -&gt; attribute : cells <strong>注意</strong>一定要选<code>cells</code>要不然得到的spread sheet行数不是cell number -&gt; check 行数是否等于画网格时定下的个数</li>
<li>Toggle cell visibility (eliminate other colons : left with only labelIDs) -&gt; export spread sheet *.csv -&gt; optional depending on paraview version (filter colons by visibility)</li>
<li>modify *.csv : add OpenFOAM header (shown below), add <code>(</code> and <code>)</code> for list</li>
<li>use OpenFOAM to read modified file via class <code>IOList&lt;label&gt;</code></li>
</ol>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// example of OpenFOAM header for file named "slice16"</span></span><br><span class="line">$ head <span class="number">-10</span> slice16</span><br><span class="line">FoamFile</span><br><span class="line">&#123;</span><br><span class="line">    version     <span class="number">2.0</span>;</span><br><span class="line">    format      ascii;</span><br><span class="line">    <span class="class"><span class="keyword">class</span>       <span class="title">labelList</span>;</span> <span class="comment">// IMPORTANT</span></span><br><span class="line">    object      slice0;    <span class="comment">// not important</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="number">16900</span></span><br><span class="line">(</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> ...</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<h3 id="scripting-1"><a href="#scripting-1" class="headerlink" title="scripting"></a>scripting</h3><h4 id="Base"><a href="#Base" class="headerlink" title="Base"></a>Base</h4><p>利用<code>Tools-&gt;Start Trace</code>选上<code>all properties</code> <code>Fully Trace Supplemental Proxies</code> <code>Show incremental Trace</code>   </p>
<ol start="0">
<li>Open -&gt; some <code>*.foam</code> file (no need for the real file when running script afterwards, but necessary here for GUI use, to generate the script to run) </li>
<li>clip… slice…</li>
<li>export as</li>
<li>Tools -&gt; End trace</li>
<li><code>pvpython script.py</code></li>
</ol>
<h4 id="Note"><a href="#Note" class="headerlink" title="Note"></a>Note</h4><ol>
<li>值得注意的是legend，利用以上python trace的结果不加改动的情况下，会默认变得巨大，所以得加上</li>
<li>加上auto-rescale是个必须得有的好习惯</li>
<li>以上1和2的改动放在<code>renderView1</code>之前，经测试是有效的</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">some operations : read some certain array</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="comment"># Properties modified on t_meanLUTColorBar    调整legend nu_mean** 需要根据实际object名字替换</span></span><br><span class="line">nu_meanLUTColorBar.TitleFontSize = <span class="number">4</span></span><br><span class="line">nu_meanLUTColorBar.LabelFontSize = <span class="number">4</span></span><br><span class="line">nu_meanLUTColorBar.ScalarBarThickness = <span class="number">5</span></span><br><span class="line">nu_meanLUTColorBar.ScalarBarLength = <span class="number">0.5</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># rescale color and/or opacity maps used to exactly fit the current data range  等同于auto-rescale</span></span><br><span class="line">slice1Display.RescaleTransferFunctionToDataRange(<span class="literal">False</span>, <span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># current camera placement for renderView1    </span></span><br><span class="line">renderView1.CameraPosition = [<span class="number">0.013999999035149813</span>, <span class="number">-0.08839503035519257</span>, <span class="number">0.0</span>]</span><br><span class="line">renderView1.CameraFocalPoint = [<span class="number">0.013999999035149813</span>, <span class="number">-0.0020000000949949026</span>, <span class="number">0.0</span>]</span><br><span class="line">renderView1.CameraViewUp = [<span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">1.0</span>]</span><br><span class="line">renderView1.CameraParallelScale = <span class="number">0.022360679233547745</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># save screenshot</span></span><br></pre></td></tr></table></figure>
<ol start="4">
<li>customize range, logscale, use another color mapping <code>它们之间</code>按照以下顺序排列是有效的</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Rescale transfer function</span></span><br><span class="line">nu_meanPWF.RescaleTransferFunction(<span class="number">2e-06</span>, <span class="number">0.0003</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># convert to log space</span></span><br><span class="line">nu_meanLUT.MapControlPointsToLogSpace()</span><br><span class="line"></span><br><span class="line"><span class="comment"># Properties modified on nu_meanLUT</span></span><br><span class="line">nu_meanLUT.UseLogScale = <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Apply a preset using its name. Note this may not work as expected when presets have duplicate names.</span></span><br><span class="line">nu_meanLUT.ApplyPreset(<span class="string">'Yellow - Gray - Blue'</span>, <span class="literal">True</span>)</span><br></pre></td></tr></table></figure>
<ol start="5">
<li>如果有多个不同位置的slice，那么一定要记得加上下面这一行(在save screenshot前就行)以保证图”有效部分”的大小不会改变</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># reset view to fit data</span></span><br><span class="line">renderView1.ResetCamera()</span><br><span class="line"></span><br><span class="line"><span class="comment"># save screenshot</span></span><br></pre></td></tr></table></figure>
<h4 id="possible-bug"><a href="#possible-bug" class="headerlink" title="possible bug"></a>possible bug</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">raise</span> ValueError(<span class="string">"%s is not a valid value for attribute %s."</span> % (value, name))</span><br><span class="line">ValueError:  <span class="keyword">is</span> <span class="keyword">not</span> a valid value <span class="keyword">for</span> attribute ScaleArrayComponent.</span><br></pre></td></tr></table></figure>
<p>可能是最初没有读入后面要用到的数组，也有可能后面取slice什么的超出了计算域，感觉报的是个找不到<code>目标数据</code>的错</p>
<h2 id="blender"><a href="#blender" class="headerlink" title="blender"></a>blender</h2><p>一句话：通过paraivew做初期可视化，包括color map，导出后可通过blender调整camera和lamp. Paraview里面也有这个功能，但相对鸡肋.   </p>
<p>blender version : 2.8 beta <a href="https://developer.blender.org/T58158" target="_blank" rel="noopener">compatibility issue : glibc too old in CentOS</a></p>
<ol>
<li>paraview -&gt; visu -&gt; File -&gt; save Data -&gt; <code>*.ply</code> (check coloring; check alpha : even if you dont have any transparency in paraview setting. This is important for blender/ or shall we say bug)   </li>
<li>blencer -&gt; File -&gt; import -&gt; <code>*.ply</code>   </li>
<li>(optional but often needed) <code>s0.01</code>（导入的data通常会显得很大，需要缩小）: scale by 0.01;<code>s90x</code>以x为轴旋转90度；blender里面朝上通常为z   </li>
<li>Now we have a render vie for data. Care now for coloring. -&gt; choose <code>blender render</code> or <code>cycles render</code>   </li>
<li>Add -&gt; input -&gt; attribut (the color attribute) : (i) name = Col ; (ii) connect “color” to “base color” of BSDF   </li>
<li>如果import的数据是contour，可能会有尖角出现，光滑一下：select mesh-&gt;object-&gt;shade smooth (need to be in object mode : normally by defaut)   </li>
<li>接下来就是调整camera和lamp了，最终blender出图是camera的视角，lamp可选太阳光什么的</li>
</ol>
<p>Note : Gratitude to Juan Ignacio Polanco</p>
<h2 id="svn"><a href="#svn" class="headerlink" title="svn"></a>svn</h2><h3 id="branching"><a href="#branching" class="headerlink" title="branching"></a>branching</h3><p>video reference <a href="https://www.youtube.com/watch?v=Y9enCuIhwY8" target="_blank" rel="noopener">createBranch</a>,<a href="https://www.youtube.com/watch?v=1LS-jHQbRXY" target="_blank" rel="noopener">workWithBranches</a>,<a href="https://www.youtube.com/watch?v=hubWjFgnjvI" target="_blank" rel="noopener">resolvingConflicts</a>,<a href="https://stackoverflow.com/questions/19451800/svn-resolve-tree-conflict-in-merge" target="_blank" rel="noopener">svn_resolve_tree_conflict_in_merge</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Note a good pratice : make sure trunk is updated to the lastest version</span></span><br><span class="line"><span class="comment"># create branch by copying trunk. </span></span><br><span class="line">$ svn copy https://subversion.renater.fr/jnnf/trunk https://subversion.renater.fr/jnnf/branches/haining -m <span class="string">'create branch haining'</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># confirm existance of branch/haining in svn server</span></span><br><span class="line">$ svn list https://subversion.renater.fr/jnnf/branches/ </span><br><span class="line"></span><br><span class="line"><span class="comment"># get branch data from svn server</span></span><br><span class="line">[branches] $ svn update <span class="comment"># better than : svn checkout https://subversion.renater.fr/jnnf/branches/haining. This will give problems when doing svn delete at the end of checkList</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># make changes on branch/haining, running tests</span></span><br><span class="line"><span class="comment"># if new file added : svn add</span></span><br><span class="line">[haining] $ svn commit -m <span class="string">'information on modification'</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># make sure branch itself is updated </span></span><br><span class="line">[haining] $ svn update </span><br><span class="line"></span><br><span class="line"><span class="comment"># now we are going to push changes to trunk. BUT</span></span><br><span class="line"><span class="comment"># firstly we have to merge from trunk to this branch (necessary step):</span></span><br><span class="line"><span class="comment"># possibly we may get some conflicts for THIS merge.</span></span><br><span class="line">[haining] $ svn merge ^/trunk</span><br><span class="line"></span><br><span class="line"><span class="comment"># verify merge by running tests</span></span><br><span class="line"><span class="comment"># commit merge</span></span><br><span class="line">[haining] $ svn commit -m <span class="string">'merge from trunk to branch/haining is sucessful. ready to reintegrate into trunk'</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># go to trunk</span></span><br><span class="line">[trunk] $ svn update</span><br><span class="line"></span><br><span class="line"><span class="comment"># now re-integrate from branch/haining to trunk then managing possible conflicts (usually choose postpone and vim)</span></span><br><span class="line">[trunk] $ svn merge --reintegrate ^/branches/haining</span><br><span class="line"></span><br><span class="line"><span class="comment"># verify again changes by running tests</span></span><br><span class="line"><span class="comment"># If all is well, we commit</span></span><br><span class="line">[trunk] $ svn commit -m <span class="string">'merged trunk from branches/haining'</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># branches/haining is now useless</span></span><br><span class="line"><span class="comment"># thus remove them from version control meaning on the svn server. </span></span><br><span class="line">[branches] $ svn rm haining </span><br><span class="line">[branches] $ svn commit <span class="string">'removing branches/haining'</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># wont be able to see 'haining' anymore</span></span><br><span class="line">$ svn list https://subversion.renater.fr/jnnf/branches/ </span><br><span class="line"></span><br><span class="line"><span class="comment"># checking status :</span></span><br><span class="line">[branches] $ svn status</span><br><span class="line">?       haining        <span class="comment"># ? means no longer in version control</span></span><br></pre></td></tr></table></figure>
<h3 id="resolving-conflict"><a href="#resolving-conflict" class="headerlink" title="resolving conflict"></a>resolving conflict</h3><p><code>!M</code> : <code>svn rm file --force</code> (if it is <code>rm *</code> not by <code>svn remove</code>)</p>
<p><code>out of date</code> : <code>svn update</code>; <code>svn resolved fileName</code> (one by one) ; <code>svn commit -m &#39;fix out of date&#39;</code></p>
<h3 id="svn和git之间相互转换"><a href="#svn和git之间相互转换" class="headerlink" title="svn和git之间相互转换"></a>svn和git之间相互转换</h3><p><strong>一定要非常注意！</strong>   </p>
<ol start="0">
<li>如果是我的thesis，先<code>make clean</code>   </li>
<li><code>cp -r</code>拷贝整个文件夹（最好不要是根目录，因为包含<code>.svn</code>或者<code>.git</code>）到目的地文件夹   </li>
<li>如果是根目录继续往下看   </li>
<li>如果是svn拷贝到git，一定要删掉<code>.svn</code> ; 如果反之，一定记得删掉 <code>.git</code> (.gitignore倒是无所谓啦)   </li>
<li>然后才<strong>开始</strong>进行其他操作</li>
</ol>
<h2 id="ubuntu-in-win10"><a href="#ubuntu-in-win10" class="headerlink" title="ubuntu in win10"></a>ubuntu in win10</h2><p>Terminal默认不能输入中文，vim打开也会乱码，需如此配置:   </p>
<ol>
<li>Terminal上端<code>right-click</code>-&gt;<code>properties</code>-&gt;<code>font</code>，改为NSimSun : 这样在终端就可以敲出中文   </li>
<li>vim 打开含中文字符的文本，<code>:set encoding?</code>如果不是<code>utf-8`</code>se:set encoding=utf-8`: 这样vim里面的中文字符就会正确解码   </li>
<li>将以上设为默认<code>right-click</code>-&gt;<code>defaut</code>;<code>.vimrc</code></li>
</ol>

    </div>

    
    
    

      <footer class="post-footer">

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2018/07/24/refineMesh/" rel="prev" title="refineMesh局部加密">
      <i class="fa fa-chevron-left"></i> refineMesh局部加密
    </a></div>
      <div class="post-nav-item">
    <a href="/2018/09/19/cheat/" rel="next" title="cheat">
      cheat <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  

  </div>


          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#检查表制度"><span class="nav-number">1.</span> <span class="nav-text">检查表制度</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#为什么我要用在OpenFOAM上"><span class="nav-number">2.</span> <span class="nav-text">为什么我要用在OpenFOAM上?</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#我的检查表"><span class="nav-number">3.</span> <span class="nav-text">我的检查表</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Pointwise"><span class="nav-number">3.1.</span> <span class="nav-text">Pointwise</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#网格导出流程"><span class="nav-number">3.1.1.</span> <span class="nav-text">网格导出流程</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#配置openfoam周期条件"><span class="nav-number">3.1.2.</span> <span class="nav-text">配置openfoam周期条件</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#OpenFOAM"><span class="nav-number">3.2.</span> <span class="nav-text">OpenFOAM</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Simulation-完整流程"><span class="nav-number">3.2.1.</span> <span class="nav-text">Simulation 完整流程</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#preProcessing"><span class="nav-number">3.2.2.</span> <span class="nav-text">preProcessing</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#mapFields"><span class="nav-number">3.2.2.1.</span> <span class="nav-text">mapFields</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#旋转data然后mapFields"><span class="nav-number">3.2.2.1.1.</span> <span class="nav-text">旋转data然后mapFields</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#postProcessing"><span class="nav-number">3.2.3.</span> <span class="nav-text">postProcessing</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#管理postProcessing"><span class="nav-number">3.2.3.1.</span> <span class="nav-text">管理postProcessing</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#uv-reynoldsStress"><span class="nav-number">3.2.3.2.</span> <span class="nav-text">uv : reynoldsStress</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#userProbeByLabel-noMean"><span class="nav-number">3.2.3.3.</span> <span class="nav-text">userProbeByLabel_noMean</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#userFindClosestInLabelList"><span class="nav-number">3.2.3.4.</span> <span class="nav-text">userFindClosestInLabelList</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#reconstructPar"><span class="nav-number">3.2.3.5.</span> <span class="nav-text">reconstructPar</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#sample"><span class="nav-number">3.2.3.6.</span> <span class="nav-text">sample</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#基本流程"><span class="nav-number">3.2.3.6.1.</span> <span class="nav-text">基本流程</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#用python写sampleDict"><span class="nav-number">3.2.3.6.2.</span> <span class="nav-text">用python写sampleDict</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#python"><span class="nav-number">3.3.</span> <span class="nav-text">python</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#laundary"><span class="nav-number">3.3.1.</span> <span class="nav-text">laundary</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#cluster"><span class="nav-number">3.4.</span> <span class="nav-text">cluster</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#occigen"><span class="nav-number">3.4.1.</span> <span class="nav-text">occigen</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#算例提交"><span class="nav-number">3.4.1.1.</span> <span class="nav-text">算例提交</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#数据同步"><span class="nav-number">3.4.1.2.</span> <span class="nav-text">数据同步</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#newton"><span class="nav-number">3.4.2.</span> <span class="nav-text">newton</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#error"><span class="nav-number">3.4.2.1.</span> <span class="nav-text">error</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#old-note"><span class="nav-number">3.4.2.2.</span> <span class="nav-text">old note</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Inkscape"><span class="nav-number">3.5.</span> <span class="nav-text">Inkscape</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#导出"><span class="nav-number">3.5.1.</span> <span class="nav-text">导出</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#clip"><span class="nav-number">3.5.2.</span> <span class="nav-text">clip</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#gimp"><span class="nav-number">3.6.</span> <span class="nav-text">gimp</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#paraview"><span class="nav-number">3.7.</span> <span class="nav-text">paraview</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#显示几何外形"><span class="nav-number">3.7.1.</span> <span class="nav-text">显示几何外形</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#scripting"><span class="nav-number">3.7.2.</span> <span class="nav-text">scripting</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#load-state"><span class="nav-number">3.7.2.1.</span> <span class="nav-text">load state</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#出图程序里面修改变量的range"><span class="nav-number">3.7.2.2.</span> <span class="nav-text">出图程序里面修改变量的range</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#纯粹读数据，摸索数据结构"><span class="nav-number">3.7.2.3.</span> <span class="nav-text">纯粹读数据，摸索数据结构</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#export-screen-shot"><span class="nav-number">3.7.3.</span> <span class="nav-text">export screen shot</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#do-not-skip-time-0"><span class="nav-number">3.7.4.</span> <span class="nav-text">do not skip time 0</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#color-map"><span class="nav-number">3.7.5.</span> <span class="nav-text">color map</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#用load-state来复现camera视角"><span class="nav-number">3.7.6.</span> <span class="nav-text">用load state来复现camera视角</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#根据x坐标截取一个cell-slice的label"><span class="nav-number">3.7.7.</span> <span class="nav-text">根据x坐标截取一个cell slice的label</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#scripting-1"><span class="nav-number">3.7.8.</span> <span class="nav-text">scripting</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Base"><span class="nav-number">3.7.8.1.</span> <span class="nav-text">Base</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Note"><span class="nav-number">3.7.8.2.</span> <span class="nav-text">Note</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#possible-bug"><span class="nav-number">3.7.8.3.</span> <span class="nav-text">possible bug</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#blender"><span class="nav-number">3.8.</span> <span class="nav-text">blender</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#svn"><span class="nav-number">3.9.</span> <span class="nav-text">svn</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#branching"><span class="nav-number">3.9.1.</span> <span class="nav-text">branching</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#resolving-conflict"><span class="nav-number">3.9.2.</span> <span class="nav-text">resolving conflict</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#svn和git之间相互转换"><span class="nav-number">3.9.3.</span> <span class="nav-text">svn和git之间相互转换</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ubuntu-in-win10"><span class="nav-number">3.10.</span> <span class="nav-text">ubuntu in win10</span></a></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Haining</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">10</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">1</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/snow-stone" title="GitHub → https://github.com/snow-stone" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://www.weibo.com/2773197063/profile?topnav=1&wvr=6&is_all=1" title="Weibo → https://www.weibo.com/2773197063/profile?topnav=1&wvr=6&is_all=1" rel="noopener" target="_blank"><i class="fa fa-fw fa-weibo"></i>Weibo</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Haining</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://muse.theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a>
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>
<script src="/js/utils.js"></script><script src="/js/motion.js"></script>
<script src="/js/schemes/muse.js"></script>
<script src="/js/next-boot.js"></script>



  















  

  

</body>
</html>
